<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1">
<title>Dashboard — Wellness Planner</title>
<link rel="stylesheet" href="style.css">
</head>
<body class="bg">
<header class="topbar card">
  <div class="brand">
    <div class="brand__logo">★</div>
    <div>
      <h1 class="brand__title" id="greet">Your dashboard</h1>
      <div class="muted" id="sub"></div>
    </div>
  </div>
  <div class="actions">
    <button class="btn btn--ghost" id="edit">Edit profile</button>
    <button class="btn btn--ghost" id="reset">Reset data</button>
  </div>
</header>

<main class="wrap">
  <!-- LEFT: “Today” panel fills that empty space -->
  <section class="card focus">
    <div class="focus__head">
      <div>
        <div class="kicker">Today</div>
        <div class="date" id="todayDate"></div>
      </div>
      <div class="toggles">
        <label class="switch">
          <input type="checkbox" id="veganToggle">
          <span>Vegan</span>
        </label>
        <select id="locSelect" class="select">
          <option value="home">At home</option>
          <option value="gym">Gym</option>
        </select>
      </div>
    </div>

    <div class="focus__grid">
      <div class="panel">
        <h3>Workout of the day</h3>
        <ul id="todaysWorkout" class="list"></ul>
        <div class="row row--between">
          <button class="btn btn--small" id="markDone">Mark as done</button>
          <div class="muted" id="streakText">Streak: 0 🔥</div>
        </div>
      </div>

      <div class="panel">
        <h3>Meal highlight</h3>
        <ul class="list" id="mealHighlight"></ul>
        <canvas id="macroPie" width="180" height="180" class="pie"></canvas>
      </div>

      <div class="panel">
        <h3>Trainer note</h3>
        <p id="tipText" class="muted"></p>
        <div class="row row--gap">
          <button class="btn btn--small btn--ghost" id="newTip">New tip</button>
          <button class="btn btn--small btn--ghost" id="hydrate">Hydration target</button>
        </div>
      </div>
    </div>
  </section>

  <!-- RIGHT: summary -->
  <aside class="card side">
    <div class="kicker">Summary</div>
    <div id="summary"></div>
    <div class="divider"></div>
    <div class="kicker">Quick actions</div>
    <div class="row row--gap">
      <a class="btn btn--soft" href="plan.html">7-Day Workout</a>
      <a class="btn btn--soft" href="meals.html">Meals & Macros</a>
    </div>
  </aside>

  <!-- FULL-WIDTH: metrics -->
  <section class="card full">
    <div class="kicker">Metrics</div>
    <div class="kpis" id="kpis"></div>
  </section>
</main>

<script src="script.js"></script>
<script>
// init
const user = getUser();
const ans = getAnswers() || defaultAnswers();
byId('greet').textContent = `Welcome${user?.name?`, ${user.name}`:''}`;
byId('sub').textContent = `Generated ${new Date().toLocaleDateString()}`;
byId('todayDate').textContent = new Date().toLocaleDateString(undefined,{weekday:'long', month:'short', day:'numeric'});

// sync UI controls
byId('veganToggle').checked = !!ans.vegan;
byId('locSelect').value = ans.location || 'home';

// recalc + paint
function paintAll(){
  const calc = computeMetrics(ans);
  paintKPIs(calc);
  paintSummary(ans, calc);
  paintToday(ans, calc);
}
paintAll();

// listeners
byId('veganToggle').addEventListener('change', e=>{
  ans.vegan = e.target.checked; saveAnswers(ans); paintAll();
});
byId('locSelect').addEventListener('change', e=>{
  ans.location = e.target.value; saveAnswers(ans); paintAll();
});
byId('edit').onclick = ()=> location.href='quiz.html';
byId('reset').onclick = ()=> { if(confirm('Clear all saved data?')) resetAll(); };

// tip & hydration
byId('newTip').onclick = ()=> paintTip(ans, computeMetrics(ans));
byId('hydrate').onclick = ()=>{
  const w = computeMetrics(ans).waterMl;
  alert(`Aim ~${w} ml water today. Increase on hot days or long sessions.`);
};

// streak & done
byId('markDone').onclick = ()=>{
  const key = todayKey();
  const prog = getProgress();
  if(!prog.doneDays.includes(key)){
    prog.doneDays.push(key);
    // streak logic
    const yest = dayKey(-1);
    prog.streak = prog.doneDays.includes(yest) ? (prog.streak||0)+1 : 1;
    saveProgress(prog);
    paintAll();
    alert('Nice work. Logged for today.');
  } else {
    alert('Already marked done for today.');
  }
};

// painters
function paintKPIs(calc){
  byId('kpis').innerHTML = `
    ${kpi('BMI', calc.bmi.toFixed(1))}
    ${kpi('Category', calc.bmiCat)}
    ${kpi('BMR', `${calc.BMR} kcal`)}
    ${kpi('TDEE', `${calc.TDEE} kcal`)}
    ${kpi('Target', `${calc.target} kcal`)}
    ${kpi('Protein', `${calc.protein} g`)}
    ${kpi('Carbs', `${calc.carbs} g`)}
    ${kpi('Fats', `${calc.fat} g`)}
  `;
}

function paintSummary(ans, calc){
  byId('summary').innerHTML = `
    <div class="muted">Goal</div><div class="lead">${calc.goal}</div>
    <div class="muted">Build</div><div>${ans.build||'-'}</div>
    <div class="muted">Workout</div><div>${ans.location||'-'}</div>
    <div class="muted">Diet</div><div>${ans.vegan?'Vegan':'Standard'}${ans.allergies?.length?` — no ${ans.allergies.join(', ')}`:''}</div>
    <div class="muted">Hydration</div><div>${calc.waterMl} ml/day</div>
  `;
}

function paintToday(ans, calc){
  // workout of the day
  const workout = (ans.location==='gym'? baseGym() : baseHome())[dowIndex()];
  byId('todaysWorkout').innerHTML = workout.map(li=>`<li>${li}</li>`).join('');

  // meal highlight (vegan aware, allergies)
  const bank = ans.vegan ? FOODS.vegan : FOODS.omni;
  const pick = safeDaily(bank, ans.allergies||[], dowIndex());
  byId('mealHighlight').innerHTML = [
    `<li><b>Breakfast:</b> ${pick.breakfast} <span class="muted">(${Math.round(calc.target*0.25)} kcal)</span></li>`,
    `<li><b>Lunch:</b> ${pick.lunch} <span class="muted">(${Math.round(calc.target*0.35)} kcal)</span></li>`,
    `<li><b>Snack:</b> ${pick.snack} <span class="muted">(${Math.round(calc.target*0.10)} kcal)</span></li>`,
    `<li><b>Dinner:</b> ${pick.dinner} <span class="muted">(${Math.round(calc.target*0.30)} kcal)</span></li>`
  ].join('');

  // tip + streak
  paintTip(ans, calc);
  const prog = getProgress();
  byId('streakText').textContent = `Streak: ${prog.streak||0} 🔥`;

  // mini pie
  drawPie('macroPie', [calc.protein*4, calc.carbs*4, calc.fat*9], ['#cc6e91','#f7a7c4','#f2d3e0']);
}

function paintTip(ans, calc){
  const list = tipsBank(ans, calc);
  byId('tipText').textContent = list[(Date.now()/86400000|0) % list.length]; // rotate daily
}

</script>
</body>
</html>
